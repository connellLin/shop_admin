## 后台服务器项目

#### 创建项目

##### 项目样式重置

```javascript
npm i normalize.css
```

src/main.js中


```javascript
import "normalize.css"
```

##### 移除脚手架创建的相关的内容

+ App.vue
+ router/index.js
+ components/HelloWorld.vue



#### 基本路由搭建

##### 安装ui库（element-ui）

```javascript
npm i element-ui -S
```


   main.js 添加 代码

```javascript
import ElementUI from 'element-ui';
import 'element-ui/lib/theme-chalk/index.css';

Vue.use(ElementUI);
```

+ 样式私有的问题

+ 登陆页   Login.vue

    ```javascript
    <div class="bg">
        <!-- 
              model : 表单数据对象，
              v-model  绑定它的属性
              label-width : label  栏宽度  
        -->
        <el-form :model="ruleForm" ref="ruleForm" :rules="rules" label-width="0" class="ruleForm">
          <h2>登录</h2>
          <!-- label :label字段-->
          <!-- prop:和 输入的数据字段保持一致，声明验证规则-->
          <el-form-item label prop="username">
            <el-input v-model="ruleForm.username"></el-input>
          </el-form-item>
          <el-form-item prop="password">
            <el-input v-model.number="ruleForm.password"></el-input>
          </el-form-item>
          <el-form-item>
            <el-button class="login-btn" type="primary" @click="loginFn">登录</el-button>
          </el-form-item>
        </el-form>
      </div>	
    ```

+ config/index.js 设置跨域代理

+ 布局使用 element-ui的布局容器

+ 侧边栏组件

	+ 除了首页以外所有导航栏，都是通过后台返回的菜单信息动态生成
	+ el-submenu，el-menu-item 的index 属性的数据类型和必填



#### 菜单页

```javascript
 菜单列表
 菜单添加，被添加的菜单类型导致被提交的数据有所区别，（图标和url不同，顶级菜单是目录，需要提交的是图标，子菜单是菜单，需要提交的是url）

 提交成功后
	 重置表单
	 关闭对话框
	 刷新表格
	
 删除操作
	 确认弹窗
	 获取id(获取id)

 编辑（使用时和添加同一个表单）
	 isAdd 修改
	 利用id 获取修改的表单数据
	 修改参数的区别（新增id）
	 通过 isAdd判断url

 重置
	对话框关闭（1.点击确定 2.点击取消 3.右上角的 x）
	重置数据(isAdd, ruleForm,)
```



#### 角色页

```JavaScript
树状空间参数

	 data: 数据
        show-checkbox : 显示选择框
        node-key : 唯一标识（使用id 字段）
        props="{
            children: 'children', // 子数据的字段
            label: 'title'   //文本关联的字段
        }"
        check-strictly : true  不严格关联 （默认false）

方法

	setCheckedKeys(key构成的数组)
	getCheckedKeys(key构成的数组)

数组和字符串的转换   join、split
```



#### 管理员页面


```javascript
 翻页器功能
	
	手动触发页数变化，获取数据的问题
	关于删除数据对于翻页器绑定的数据（页码和总数的）的影响

 删除参数 是uid
```



#### 商品分类页面

##### 原生上传

```javascript
图片上传
    
    <input type="file" ref="uploadImg" />
        
     // 1、获取图片
    //  赋值img
    this.ruleForm.img = this.$refs.uploadImg.files[0];
    console.log(this.ruleForm);
    this.$refs.ruleForm.validate(valid => {
      if (valid) {
        console.log(this.ruleForm);
        // 提交前切换status
    this.ruleForm.status = this.ruleForm.status ? 1 : 2;
  
    //  2、装备好上传数据的容器
    let formData = new FormData();
    for (var key in this.ruleForm) {
      //   2-2向formData中添加数据的方法 append(数据名称，数据值)
      formData.append(key, this.ruleForm[key]);
    }
  
    console.log(formData);
    //  isAdd:true 进行添加操作， false:编辑操作
    let url = this.isAdd ? "/cateadd" : "/cateedit";
  
    //  3、上传，修改Content-Type
    httpAuth
      .post(url, formData, {
        headers: {
          "Content-Type": "multipart/form-data" //为了实现文件上传修改content-type
        }
      })
      .then(res => {
        if (res.code == 200) {
          console.log(res);
          this.dialogFormVisible = false;
          // 更新表格数据
          this.getTableData();
          this.$message.success("提交成功");
        }
      });
  }
});
        
```

##### el-uoload 组件上传

```javascript
<!-- 上传 
on-preview : 点击预览触发的回调
on-change : 选中图片时的回调
list-type : 照片墙模式
aution : 自动上传地址（禁用）
auto-upload : 禁止自动上传（默认开启）
file-list : 上传列表
-->
 
<el-upload
    action="#"
    :auto-upload="false"
    list-type="picture-card"
    :on-preview="pictureCardPreview"
    :on-change="pictureChange"
    ref="upload"
    :file-list="fileList"
 >
    <i class="el-icon-plus"></i>
</el-upload>

<!-- 图片预览
dialog的嵌套堆叠顺序
append-to-body:使内部的dialog堆在上面
 -->
    
<el-dialog :visible.sync="dialogImgVisible" append-to-body>
    <img width="100%" :src="dialogImgUrl" alt />
</el-dialog>
 
pictureChange(file,fileList) {
  // 1.获取图片
  // 赋值img
  // console.log(file,fileList);
  // 选中图片的时候设置上传图片
  this.ruleForm.img = file.raw;
},
console.log(this.ruleForm);
  this.$refs.ruleForm.validate(valid => {
    if (valid) {
      console.log(this.ruleForm);

      // 提交前切换status
      this.ruleForm.status = this.ruleForm.status ? 1 : 2;

      // 2.装备好上传数据的容器
      let formData = new FormData();
      for (var key in this.ruleForm) {
        //   2-2向formData中添加数据的方法 append(数据名称，数据值)
        formData.append(key, this.ruleForm[key]);
      }

      console.log(formData);
      //  isAdd:true 进行添加操作， false:编辑操作
      let url = this.isAdd ? "/cateadd" : "/cateedit";

      // 3.上传，修改Content-Type
      httpAuth
        .post(url, formData, {
          headers: {
            "Content-Type": "multipart/form-data" //为了实现文件上传修改content-type
          }
        })
        .then(res => {
          if (res.code == 200) {
            console.log(res);
            this.dialogFormVisible = false;
            // 更新表格数据
            this.getTableData();
            this.$message.success("提交成功");
          }
        });
    }
  });
```

上传文件的步骤
1. 获取上传文件
2. 将数据存放 formData实例中
3. 上传，改写Content-Type 



#### 属性页

+ 组件拆分
	+ 父组件-容器
	+ 列表子组件
	+ 对话框子组件和表单子组件

+ 组件传值 （组件的拆分->组件通信的问题->使用vuex解决）

	+ vuex保存的数据（在不同的组件中都使用和修改的修改）
	+ tableData 数据 

		1. 父组件 的created 中 发出action, 请求数据，-》提交mutation->修改 state中 tableData->table 组件作为计算属性使用
		2. dialog组件提交操作 发出action ,action 内部再发出请求tableData 数据 的action
	+ 处理多个页面的数据，将vuex 进行模块化

+ 提交的数据中attrs 问题

	+ v-model绑定列表渲染（绑定的是列表项的属性）
	+ map方法 提交数据的时的对象数组 转化为 字符串数组
	+ map 编辑时的数据从 字符串数据在转为对象数组



#### 富文本编辑框的使用

下载

```javascript
npm i wangeditor
```

使用

```javascript
import E from "wangeditor"

//  指定容器id 
this.editor = new E("#container");

this.editor.create(); // 创建富文本编辑器

获取编辑器中的文本
this.editor.txt.html();

设置编辑器中的文本
this.editor.txt.html(字符串);

清空和销毁
this.editor.clear();
this.editor.destory();
```

**一定要在获取容器DOM后进行创建 **



#### 数据可视化-echarts

安装：

```javascript
npm install echarts --save
```


创建容器 

```javascript
<div id="main" style="width: 800px;height:600px;"></div>
```

引入&使用

```javascript
import * as echarts from "echarts";

mounted() {
    // 初始化   init(容器元素)
    var myChart = echarts.init(document.getElementById("main"));
    // 设置配置对象
    const option = {
      // 表格标题
      title: {
        text: "ECharts 入门示例"
      },
      legend: {
        data: ["库存量", "销量"]
      },
      // 悬停信息显示
      tooltip: {},
      toolbox: {
        show: true,
        feature: {
          // dataZoom: {
          //   yAxisIndex: "none"
          // },
          // dataView: {
          //   readOnly: false
          // },
          // magicType: {
          //   type: ["line", "bar"]
          // },
          // restore: {},
          saveAsImage: {}
        }
      },
      color:["red","gold"],
      // x 轴
      xAxis: {
        data: ["Wen", "羊毛衫", "雪纺衫", "裤子", "高跟鞋", "袜子"],
        boundaryGap: false
      },
      // y 轴
      yAxis: {
        // max:100
      },
      // 数据
      series: [
        {
          name: "销量",
          type: "line",
          data: [5, 20, 36, 10, 10, 20]
        },
        {
          name: "库存量",
          type: "line",
          data: [20, 10, 16, 20, 30, 5]
        }
      ]
    };
    // 绘制图表 : 实例设置配置项
    myChart.setOption(option);
  }
```



#### 访问权限设置


```javascript
  router.beforeEach((to,from,next)=>{
	  // 通过获取本地存储中userinfo 判断是否已登录
	  let userinfo = localStorage.getItem("userinfo")?JSON.parse(localStorage.getItem("userinfo")):false;
	
	  // 已登录
	  if(userinfo){
	    // 后台允许访问的地址
	    let menus_url = userinfo.menus_url.concat(["/index","/"]);
	    console.log(menus_url)
	    // 判断目的路由是否是后台允许访问的路由
	    let auth = menus_url.indexOf(to.path)>-1?true:false;
	    console.log(auth)
	    // 登陆页不可以访问
	    if(to.path=="/login"){
	      next(false);
	    }else{
	      // 其他页面正常访问
	      // next();
	      // 有权限 
	      if(auth){
	        next()
	      }else{
	        // 没有权限
	        next(false)
	      }
	    }
	  }else{
	    // // 未登录
	    if(to.path=="/login"){
	      next();
	    }else{
	      next("/login")
	    }
	    // next("/login")
	  }
	})
```



#### stylus-CSS预处理器

安装

```javascript
npm i stylus stylus-loader@3.0.2 -D
```


语法和使用

```javascript
<style lang="stylus" scoped>
// 1. 将{}  :   ; 都可以省略
// 2. 使用缩进代表层次关系
// 3.  =  赋值形式声明变量
// 4. 属性变量 同样有变量使用{}包裹
// 5. 可以进行运算 除法使用小括号
// 6.  使用流程控制 if else 和 for in 循环
// 7. 声明函数， 混写

bg = #f1c2e9
h = height 

add(a,b) { 
	a+b
}

// add1(a,b=30){
//   if(b<20){
//     a+b
//   }else{
//     a
//   }
// }

// common(){
//   margin 30px 
//   padding 50px
// }

.layout 
  // height 100%
  {h} 100%
  background bg
  .container {
    height: 100%;
  }
  .box{
    // width 50px + 30
    // width 50px + 30%
    // width  50px - 2px
    // width 50px*2
    // width (100px / 2)
    // width add(20px,30px)
    // width add1(30px,15px)
    // common()
    
  }
  for item in  1 2 3
    .box{item}
      width item*50px
</style>
```
